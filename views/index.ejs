<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="TJBot Admin Screen">
    <meta name="author" content="Henrique SÃ¤uberli">
    <link rel="icon" href="../../../../favicon.ico">

    <title>TJBot Cockpit</title>

    <!-- Bootstrap core CSS -->
    <!--link href="../../../../dist/css/bootstrap.min.css" rel="stylesheet"-->

    <!-- Custom styles for this template -->
    
    <link rel='stylesheet' href='/stylesheets/style.css' />
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">
    <script src="/socket.io/socket.io.js"></script>
  </head>
  <body>
  	<header>
      <div class="collapse bg-dark" id="navbarHeader">
        <div class="container">
          <div class="row">
            <div class="col-sm-8 py-4">
              <h4 class="text-white">About</h4>
              <p class="text-muted">The cockpit shows the list of TJBots running the client.</p>
            </div>
            <div class="col-sm-4 py-4">
              <h4 class="text-white">Contact</h4>
              <ul class="list-unstyled">
                <li><a href="https://twitter.com/Hiqdare" class="text-white">Follow on Twitter</a></li>
              </ul>
            </div>
          </div>
        </div>
      </div>
      <div class="navbar navbar-dark bg-dark">
        <div class="container d-flex justify-content-between">
          <a href="#" class="navbar-brand">TJBot Cockpit</a>
          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarHeader" aria-controls="navbarHeader" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
        </div>
      </div>
    </header>

    <main role="main">
      <!--section class="jumbotron text-left"-->
        <div class="container">
          <p class="lead text-muted" id="botcount">-</p>
        </div>
      <!--/section-->

      <div class="album text-muted">
        <div class="container">

          <div class="row" id="rowbot">
            <div class="template d-none" id="bot">
                <img src="images/generic.jpeg" class="rounded-circle tjbot" alt="TJBot Neon">
                <div class="table_div">
                  <table class="table table-sm">
                      <tbody>
                        <tr><td class="col_1"><i class="far fa-file-code" alt="update" data-toggle="tooltip" title="Source code"></i></td><td class="col_2 source_version"></td><td class="col_3"><i class="fas fa-recycle source_update" alt="update" data-toggle="tooltip" title="Update Source code"></i></td></tr>
                        <tr><td><img src="images/nodejs.png" class="logo_mini" alt="node.js" data-toggle="tooltip" title="node.js"></td><td class="nodejs_version"></td><td><i class="fas fa-recycle source_update" alt="update" data-toggle="tooltip" title="Update node.js"></i></td></tr>
                        <tr><td><img src="images/npm.png" class="logo_mini" alt="npm" data-toggle="tooltip" title="npm"></td><td class="npm_version"></td><td><i class="fas fa-recycle source_update" alt="update" data-toggle="tooltip" title="Update npm"></i></td></tr>
                        <tr><td><img src="images/raspbian.png" class="logo_mini" alt="os version" data-toggle="tooltip" title="os version"></td><td class="os_version"></td><td></td></tr>
                        <tr><td><img src="images/raspberry_logo.png" class="logo_mini" alt="firmware version" data-toggle="tooltip" title="firmware version"></td><td class="firmware"></td><td></td></tr>
                      </tbody>
                    </table>
                </div>
                <!--div class="image_source">
                    <i class="far fa-file-code" alt="update" data-toggle="tooltip" title="Source code"></i><code class="source_version"></code><i class="fas fa-recycle source_update" alt="update" data-toggle="tooltip" title="Update Source code"></i>
                </div>
                <div class="image_nodejs">
                  <img src="images/nodejs.png" class="logo_mini" alt="node.js" data-toggle="tooltip" title="node.js"><code class="nodejs_version"></code><i class="fas fa-recycle nodejs_update" alt="update" data-toggle="tooltip" title="Update node.js"></i>
                </div>
                <div class="image_npm">
                  <img src="images/npm.png" class="logo_mini" alt="npm" data-toggle="tooltip" title="npm"><code class="npm_version"></code><i class="fas fa-recycle npm_update" alt="update" data-toggle="tooltip" title="Update npm"></i>
                </div>
                <div class="image_os">
                  <img src="images/raspberry_logo.png" class="logo_mini" alt="os version" data-toggle="tooltip" title="OS version"><code class="os_version"></code>
                </div-->
                <div class="image_lightbulb">
                    <i class="far fa-lightbulb" alt="test light" data-toggle="tooltip" title="Light"></i>
                </div>
                <div class="image_hand">
                    <i class="far fa-hand-paper" alt="wave hand" data-toggle="tooltip" title="wave hand"></i>
                </div-->
                <div class="tjbot_name">
                  Incognito    
                </div-->
            		<table class="table table-sm bot-table">
            			<tbody />
            		</table>
              	<!--img data-src="holder.js/100px280?theme=thumb" alt="Card image cap"-->
            </div>
          </div>

        </div>
      </div>

    </main> 

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <!-- Popper JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
    <!-- Latest compiled JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
    <!--script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js" integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js" integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ" crossorigin="anonymous"></script>
    -->
    <script src="javascripts/assets/js/holder.min.js"></script>
    <script>
      Holder.addTheme('thumb', {
        bg: '#55595c',
        fg: '#eceeef',
        text: 'Thumbnail'
      });
    </script>
    <script>
      $(function(){
        var i = 0;
        
        var socket = io('//' + document.location.hostname + ':' + document.location.port);
          
        socket.on('start', function(data) {
          console.log('start: ' + data);
          socket.emit('browser');
        });
      
        socket.on('botlist', function(data) {
          botlist = JSON.parse(data);
          $("#rowbot").children(".card").remove();
          console.log("new bot list: " + botlist.length);
          $("#botcount").text("TJBots online: " + botlist.length);
          if (botlist.length > 0) {
            for (var i = 0; i < botlist.length; i++) {
              addBotToList(botlist[i]);
            }
          }
        });

        socket.on('refresh', function(data) {
          botlist = JSON.parse(data);
          $("#rowbot").children(".card").remove();
          console.log("new bot list: " + botlist.length);
          $("#botcount").text("TJBots online: " + botlist.length);
          if (botlist.length > 0) {
            for (var i = 0; i < botlist.length; i++) {
              addBotToList(botlist[i]);
            }
          }
        });
        
        function addBotToList(bot) {
          var node;
          var clone = $('#bot').clone(true); // "deep" clone
          clone.removeAttr('id');
          clone.removeClass();
          clone.addClass("card col-lg-4 col-sm-6");
          table = clone.children(".table")[0];
          $('#bot').parent().append(clone);
          /*for (var key in bot) {
            if (bot.hasOwnProperty(key)) { 
              row = table.insertRow(0);
              keyCell = row.insertCell(0);
              textCell = row.insertCell(1);
              keyCell.innerHTML = key;
              textCell.innerHTML = bot[key];
            }
          }*/
          clone.find(".source_update").click(function(){
            socket.emit('update', '{"socket_id":"' + bot.socket_id + '", "target": "source"}');
          });
          clone.find(".nodejs_update").click(function(){
            socket.emit('update', '{"socket_id":"' + bot.socket_id + '", "target": "nodejs"}');
          });
          clone.find(".npm_update").click(function(){
            window.alert('updating npm');
            socket.emit('update', '{"socket_id":"' + bot.socket_id + '", "target": "npm"}');
          });
          var tjImage = clone.find(".tjbot");
          tjImage.attr("src", "images/" + bot.image);
          tjImage.attr("src", "images/" + bot.image);
          tjImage.click(function() {
            clone.find(".bot-table").toggle();
          });
          clone.find(".tjbot_name").text(bot.name);
          clone.find(".source_version").text(" " + bot.npm_version.tjbotclient + " ");
          clone.find(".nodejs_version").text(" " + bot.nodejs_version + " ");
          clone.find(".npm_version").text(" " + bot.npm_version.npm + " ");
          clone.find(".firmware").text(" " + bot.firmware + " ");
        }
      }); 
    </script>
  </body>
</html>
