<!DOCTYPE html>
<html style="height: 100%;" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="Content-Language" content="EN" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="TJBot Cockpit" />
    <meta name="author" content="Henrique SÃ¤uberli" />
    <link rel="icon" href="../../../../favicon.ico">

    <title>TJBot Cockpit</title>
    <!-- Custom styles for this template -->

    <link rel="stylesheet" href="./w3ds/w3ds-3.8.6.css" type="text/css">

    <!-- if data tables are required -->
    <link rel="stylesheet" href="./w3ds/w3ds-data-tables.css" type="text/css">
    
    <!-- if code syntax highlighting is required -->
    <link rel="stylesheet" href="./w3ds/w3ds-prism.css" rel="text/css" />
    
    <link rel='stylesheet' href='/stylesheets/style.css' />
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">
  </head>
  <body class="ds-has-sticky-footer">
    <div class="ds-grid">
      <div class="ds-row">
        <div class="ds-col-12">
          <div class="ds-row ds-pad-t-3">
            <div class="ds-col-xs-10 ds-offset-xs-1 ds-pad-b-3">
              <h1 class="ds-heading-md-2 ds-heading-lg-1">TJBot Cockpit</h1>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="ds-grid">
      <div class="ds-row ds-pad-b-3">
        <div class="ds-col-sm-12 ds-col-md-6 ds-col-lg-4 ds-col-xl-3 ds-pad-b-xs-1 ds-hide template" id="bot">
          <!--div class="ds-panel ds-panel-raised"-->
          <div class="ds-row">
            <div class="ds-col-4 thumbnail_div">
              <img src="images/generic.jpeg" class="ds-img-force-grow ds-border-blue-6 thumbnail" alt="TJBot Neon">
            </div>
            <div class="ds-accordion-container ds-mar-t-0 ds-mar-b-0" aria-labelledby="Column width accordion example">
                <div class="ds-row ds-accordion-item" aria-controls="ds-accordion-slidedown" aria-expanded="false" role="accordion item">
                    <div class="ds-accordion-title">Column width item 1</div>
                    <div class="ds-accordion-slidedown" aria-hidden="true" role="region">
                        <p class="ds-mar-b-0">
                            Lorem ipsum dolor sit amet, consectetur adipisicing elit. Consequuntur quas quisquam numquam, provident nobis ipsam fugiat est vel nam, cupiditate laboriosam minima cumque voluptate vero illo assumenda iste, architecto? Cupiditate.
                        </p>
                    </div>
                </div>
                <div class="ds-row ds-accordion-item" aria-controls="ds-accordion-slidedown" aria-expanded="false" role="accordion item">
                    <div class="ds-accordion-title">Column width item 2</div>
                    <div class="ds-accordion-slidedown" aria-hidden="true" role="region">
                        <p class="ds-mar-b-0">
                            Lorem ipsum dolor sit amet, consectetur adipisicing elit. Consequuntur quas quisquam numquam, provident nobis ipsam fugiat est vel nam, cupiditate laboriosam minima cumque voluptate vero illo assumenda iste, architecto? Cupiditate.
                        </p>
                    </div>
                </div>
                <div class="ds-row ds-accordion-item" aria-controls="ds-accordion-slidedown" aria-expanded="false" role="accordion item">
                    <div class="ds-accordion-title">Column width item 3</div>
                    <div class="ds-accordion-slidedown" aria-hidden="true" role="region">
                        <p class="ds-mar-b-0">
                            Lorem ipsum dolor sit amet, consectetur adipisicing elit. Consequuntur quas quisquam numquam, provident nobis ipsam fugiat est vel nam, cupiditate laboriosam minima cumque voluptate vero illo assumenda iste, architecto? Cupiditate.
                        </p>
                    </div>
                </div>
            </div>
            <!--div class="ds-accordion-container-sm">
              <div class="ds-panel-container">
                <div class="ds-row code-snippet ds-accordion-item ds-mar-b-0" aria-expanded="false" role="accordion" tabindex="0">
                  <div class="ds-accordion-title ds-label">Info</div>
                  <div id="tray-nav-click-1" class="ds-accordion-slidedown ds-row ds-mar-l-0 ds-mar-r-0 ds-tray ds-tray-click-open" aria-hidden="true" role="dialog">
                      <div class="ds-col-8">
                        <div class="ds-flex ds-flex-align_items-center">
                          <span class="ds-mar-r-2 far fa-file-code ds-heading-4" alt="update" data-toggle="tooltip" title="Source code"></span>
                          <p class="ds-mar-b-1 source_version">-</p>
                          <span class="fas fa-recycle source_update" alt="update" data-toggle="tooltip" title="Update Source code" style="margin-left: auto;"></p>
                        </div>
                        <div class="ds-flex ds-flex-align_items-center">
                          <img src="images/nodejs.png" class="ds-mar-r-2 logo_mini ds-heading-4" alt="node.js" data-toggle="tooltip" title="node.js">
                          <p class="ds-mar-b-1 nodejs_version">-</p>
                          <span class="fas fa-recycle nodejs_update" alt="update" data-toggle="tooltip" title="Update node.js" style="margin-left: auto;"></p>
                        </div>
                        <div class="ds-flex ds-flex-align_items-center">
                          <img src="images/npm.png" class="ds-mar-r-2 logo_mini ds-heading-4" alt="npm" data-toggle="tooltip" title="npm">
                          <p class="ds-mar-b-1 npm_version">-</p>
                          <span class="fas fa-recycle npm_update" alt="update" data-toggle="tooltip" title="Update npm" style="margin-left: auto;"></p>
                        </div>
                        <div class="ds-flex ds-flex-align_items-center">
                          <img src="images/raspbian.png" class="ds-mar-r-2 logo_mini ds-heading-4" alt="os version" data-toggle="tooltip" title="os version">
                          <p class="ds-mar-b-1 os_version">-</p>
                        </div>
                        <div class="ds-flex ds-flex-align_items-center">
                          <img src="images/raspberry_logo.png" class="ds-mar-r-2 logo_mini ds-heading-4" alt="firmware version" data-toggle="tooltip" title="firmware version">
                          <p class="ds-mar-b-1 firmware">-</p>
                        </div>
                      </div>

                  </div>
                </div>
              </div>
            </div-->
          </div>
      </div>
    </div>

    <footer class="ds-sticky-footer ds-grid ds-bg-neutral-warm-2" style="width: 100%; height: 110px;" >
      <div class="ds-row">
        <h5 class="ds-offset-xs-1 ds-col-xs-10 ds-pad-t-2_5 ds-heading-5">
          <span class="ds-icon-github-l" style="vertical-align: middle;"></span>
          <a href="https://github.ibm.com/w3/w3DS" target="_blank" class="ds-text-neutral-6 ds-font-weight-light">w3DS on GitHub</a>
        </h5>
      </div>
    </footer>
  	<!--header>
      <div class="collapse bg-dark" id="navbarHeader">
        <div class="container">
          <div class="row">
            <div class="col-sm-8 py-4">
              <h4 class="text-white">About</h4>
              <p class="text-muted">The cockpit shows the list of TJBots running the client.</p>
            </div>
            <div class="col-sm-4 py-4">
              <h4 class="text-white">Contact</h4>
              <ul class="list-unstyled">
                <li><a href="https://twitter.com/Hiqdare" class="text-white">Follow on Twitter</a></li>
              </ul>
            </div>
          </div>
        </div>
      </div>
      <div class="navbar navbar-dark bg-dark">
        <div class="container d-flex justify-content-between">
          <a href="#" class="navbar-brand">TJBot Cockpit</a>
          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarHeader" aria-controls="navbarHeader" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
        </div>
      </div>
    </header-->

    <!--main role="main"-->
      <!--section class="jumbotron text-left"-->
        <!--div class="container">
          <p class="lead text-muted" id="botcount">-</p>
        </div>
      <!--/section-->

      <!--div class="album text-muted">
        <div class="container">

          <div class="row" id="rowbot">
            <div class="template d-none" id="bot">
                <img src="images/generic.jpeg" class="rounded-circle tjbot" alt="TJBot Neon">
                <div class="table_div">
                  <table class="table table-sm">
                      <tbody>
                        <tr><td class="col_1"><i class="far fa-file-code" alt="update" data-toggle="tooltip" title="Source code"></i></td><td class="col_2 source_version"></td><td class="col_3"><i class="fas fa-recycle source_update" alt="update" data-toggle="tooltip" title="Update Source code"></i></td></tr>
                        <tr><td><img src="images/nodejs.png" class="logo_mini" alt="node.js" data-toggle="tooltip" title="node.js"></td><td class="nodejs_version"></td><td><i class="fas fa-recycle nodejs_update" alt="update" data-toggle="tooltip" title="Update node.js"></i></td></tr>
                        <tr><td><img src="images/npm.png" class="logo_mini" alt="npm" data-toggle="tooltip" title="npm"></td><td class="npm_version"></td><td><i class="fas fa-recycle npm_update" alt="update" data-toggle="tooltip" title="Update npm"></i></td></tr>
                        <tr><td><img src="images/raspbian.png" class="logo_mini" alt="os version" data-toggle="tooltip" title="os version"></td><td class="os_version"></td><td></td></tr>
                        <tr><td><img src="images/raspberry_logo.png" class="logo_mini" alt="firmware version" data-toggle="tooltip" title="firmware version"></td><td class="firmware"></td><td></td></tr>
                      </tbody>
                    </table>
                </div>
                <div class="status">
                  <i class="fas fa-signal" alt="status" data-toggle="tooltip" title="Status"></i>
                </div>
                <div class="image_lightbulb">
                    <i class="far fa-lightbulb" alt="test light" data-toggle="tooltip" title="Light"></i>
                </div>
                <div class="image_hand">
                    <i class="far fa-hand-paper" alt="wave hand" data-toggle="tooltip" title="wave hand"></i>
                </div>
                <div class="tjbot_name">
                  Incognito    
                </div>
            </div>
          </div>
        </div>
        <div class="container detailinfo">
          <img src="images/generic.jpeg" class="rounded-circle info_image" alt="TJBot Neon">
          <span id="close_detail" class="ds-icon-size-medium ds-icon-close-circle-m-l"></span>
          <table class="table table-sm bot-table">
            <tbody>
              <tr><td>Name:</td><td id="name"></td></tr>
              <tr><td>Favourite Chocolate:</td><td id="chocolate"></td></tr>
              <tr><td>Location</td><td id="location"></td></tr>
              <tr><td>Owner:</td><td id="owner"></td></tr>
              <tr><td><img src="images/raspbian.png" class="logo_mini" alt="os version" data-toggle="tooltip" title="os version"></td><td id="os_platform"></td></tr>
              <tr><td><img src="images/nodejs.png" class="logo_mini" alt="node.js" data-toggle="tooltip" title="node.js"></td><td id="nodejs_version"></td></tr>
              <tr><td><img src="images/raspberry_logo.png" class="logo_mini" alt="firmware version" data-toggle="tooltip" title="firmware version"></td><td id="firmware"></td></tr>
              <tr><td><img src="images/npm.png" class="logo_mini" alt="npm" data-toggle="tooltip" title="npm"></td><td id="npm_version"></td></tr>
              <tr><td>Details</td><td id="detail_tree"></td></tr>
              <tr><td>socket id:</td><td id="socket_id"></td></tr>
            </tbody>
          </table>
        </div>
        <!--div class="dropdown">
          <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenu2" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Dropdown
          </button>
          <div class="dropdown-menu" aria-labelledby="dropdownMenu2">
            <button class="dropdown-item" type="button">Action</button>
            <button class="dropdown-item" type="button">Another action</button>
            <button class="dropdown-item" type="button">Something else here</button>
          </div>
        </div-->
      <!--/div>

    </main> 

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <!-- Latest compiled and minified CSS -->
    <!--link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.2.1/themes/default/style.min.css" /-->
    
    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <!-- Popper JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
    <!-- Latest compiled JavaScript -->
    <!--script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script-->
    <!--script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js" integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js" integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ" crossorigin="anonymous"></script>
    -->
    <!--script src="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.2.1/jstree.min.js"></script-->
    <script src="/javascripts/assets/js/holder.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script src="/w3ds/w3ds-3.8.6.js"></script>
    <script>
      $(function(){
        var i = 0;
        var socket = io('//' + document.location.hostname + ':' + document.location.port);
        $(".close_detail").click(function() {
          $(".detailinfo").hide("scale");
        });
          
        socket.on('start', function(data) {
          console.log('start: ' + data);
          socket.emit('browser');
        });
      
        socket.on('botlist', function(data) {
          botlist = JSON.parse(data);
          //$("#rowbot").children(".card").remove();
          console.log("new bot list: " + botlist.length);
          $("#botcount").text("TJBots online: " + botlist.length);
          if (botlist.length > 0) {
            for (var i = 0; i < botlist.length; i++) {
              addBotToList(botlist[i]);
            }
          }
        });

        socket.on('refresh', function(data) {
          botlist = JSON.parse(data);
          //$("#rowbot").children(".card").remove();
          console.log("new bot list: " + botlist.length);
          $("#botcount").text("TJBots online: " + botlist.length);
          if (botlist.length > 0) {
            for (var i = 0; i < botlist.length; i++) {
              addBotToList(botlist[i]);
            }
          }
        });
        
        function addBotToList(bot) {
          var node;
          var infowindow;
          var clone = $('#bot').clone(true); // "deep" clone
          clone.removeAttr('id');
          clone.removeClass('ds-hide template');
          $('#bot').parent().append(clone);
          clone.find(".source_update").click(function(){
            socket.emit('update', '{"socket_id":"' + bot.web.socket_id + '", "target": "source"}');
          });
          clone.find(".nodejs_update").click(function(){
            socket.emit('update', '{"socket_id":"' + bot.web.socket_id + '", "target": "nodejs"}');
          });
          clone.find(".npm_update").click(function(){
            window.alert('updating npm');
            socket.emit('update', '{"socket_id":"' + bot.web.socket_id + '", "target": "npm"}');
          });
          var tjImage = clone.find(".tjbot");
          tjImage.attr("src", "images/" + bot.basic.image);
          tjImage.attr("alt", "images/" + bot.basic.image);

          tjImage.click(function() {
            populateBotDetail(bot);
          });
          var status = clone.find(".status");
          status.removeClass();
          status.addClass("status " + bot.web.status);
          clone.find(".tjbot_name").text(bot.basic.name);
          clone.find(".source_version").text(" " + bot.data.npm_version.tjbotclient + " ");
          clone.find(".nodejs_version").text(" " + bot.data.nodejs_version + " ");
          clone.find(".npm_version").text(" " + bot.data.npm_version.npm + " ");
          clone.find(".firmware").text(" " + bot.data.firmware + " ");
        }

        function populateBotDetail(bot) {

            $(".detailinfo").show("scale");
            $(".info_image").attr("src", "images/" + bot.basic.image);
            $(".info_image").attr("alt", "images/" + bot.basic.image);

            table = $(".bot-table")[0];
            /*var tree = { 
              'core' : {
                'themes':{
                  'icons':false
                },
                'data' : []
            }};
                    /*'Simple root node',
                    {
                      'text' : 'Root node 2',
                      'state' : {
                        'opened' : false,
                        'selected' : false
                      },
                      'children' : [
                        { 'text' : 'Child 1' },
                        'Child 2'
                      ]
                    }
            tree.core.data = getTree(bot);


            $('#detail_tree').jstree(tree);*/
        }

        function getTree(part) {
          var result = [];
          if (Array.isArray(part)) {
            var elemTree;
            console.log("is array");
            part.forEach(function(elem){
              elemTree = getTree(elem);
              if (elemTree.length == 1) {
                result.push(elemTree[0]);
              } else {
                result.push(elemTree);
              }
              
            });
            return result;
          } else if (typeof part === 'object' && part !== null) {
            console.log("is object");
            Object.keys(part).forEach(function(key) {
              var node = {};
              node.text = key;
              node.state = {};
              node.state.opened = false;
              node.state.selected = false;
              node.children = getTree(part[key]);
              result.push(node);
            });
            return result
          } else {
            console.log(part + "is primitve");
            result.push(part);
            return result;
          }
        }
      }); 
    </script>
  </body>
</html>
